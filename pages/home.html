<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bitmap Compression Visualizer</title>
    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="../styles/styles.css">
    <link rel="stylesheet" href="../styles/home.css">
</head>
<body>
    <script type="module" src="../imports/components.js" type="text/javascript"></script>
    <nav-bar active-link="home.html"></nav-bar>

    <div class="container mt-4">
        <h1 class="mb-4">How to Use This Site</h1>

        <section class="toc-section">
            <h2 class="h4 mb-3">Quick Navigation</h2>
            <div class="toc-grid">
                <div class="toc-card">
                    <h3>Getting Started</h3>
                    <ul>
                        <li><a href="#input-options">Input & Options</a></li>
                        <li><a href="#terms">Terms to Know</a></li>
                        <li><a href="#animations">Stepping Through Animations</a></li>
                        <li><a href="#diff-checker">Using the Diff Checker</a></li>
                    </ul>
                </div>
                <div class="toc-card">
                    <h3>Compression Algorithms</h3>
                    <ul>
                        <li><a href="#wah">Word-Aligned Hybrid (WAH)</a></li>
                        <li><a href="#bbc">Byte-aligned Bitmap Compression (BBC)</a></li>
                        <li><a href="#plwah">Position List WAH (PLWAH)</a></li>
                        <li><a href="#val">Variable Aligned Length (VAL)</a></li>
                    </ul>
                </div>
            </div>
        </section>

        <div class="start-button-container">
            <a href="animation.html" class="btn btn-primary btn-lg start-button">
                Start Compressing
                <svg width="16" height="16" fill="currentColor" class="bi bi-arrow-right" viewBox="0 0 16 16" style="margin-left: 0.5rem;">
                    <path fill-rule="evenodd" d="M1 8a.5.5 0 0 1 .5-.5h11.793l-3.147-3.146a.5.5 0 0 1 .708-.708l4 4a.5.5 0 0 1 0 .708l-4 4a.5.5 0 0 1-.708-.708L13.293 8.5H1.5A.5.5 0 0 1 1 8z"/>
                </svg>
            </a>
        </div>

        <section id="input-options" class="content-section">
            <h2>Input & Options</h2>
            <img src="../assets/annotatedAnimationPage.png" alt="Annotated animation page" class="overview-image mb-4 rounded">
            
            <p>Enter your data on the input page and choose which compression algorithm to animate.</p>
            
            <div class="parameters-section">
                <h3>Adjust parameters as needed:</h3>
                <img src="../assets/algorithmSelection.png" alt="Algorithm selection buttons" class="feature-image mb-3 rounded">
                <ul>
                    <li><strong>Wordsize:</strong> The size of the compression chunks. (For BBC, it's always 8.)</li>
                    <li><strong>Segments:</strong> The size of sections being compressed, only changeable for VAL (it divides the word into multiple parts).</li>
                </ul>
            </div>
        </section>

        <section id="terms" class="content-section">
            <h2>Terms to Know</h2>
            <div class="terms-grid">
                <div class="term-card">
                    <h4>Run</h4>
                    <p>A sequence of identical bits</p>
                    <code>1111</code> or <code>0000</code>
                </div>
                <div class="term-card">
                    <h4>Literal</h4>
                    <p>A word that directly stores bits without compression</p>
                </div>
                <div class="term-card">
                    <h4>Dirty Bit</h4>
                    <p>Bits that stop a run from happening</p>
                    <code>00100000</code> (1 is the dirty bit)
                </div>
            </div>
        </section>

        <section id="animations" class="content-section">
            <h2>Stepping Through Animations</h2>
            <div class="animation-demo">
                <img src="../assets/animation.gif" alt="Animation demonstration" class="feature-image mb-3 rounded">
                <div class="controls-explanation">
                    <ul>
                        <li><strong>Next Step:</strong> Jumps from the start of a run to its final compressed word</li>
                        <li><strong>Micro Step:</strong> Moves through each word in the run</li>
                        <li><strong>Back Step:</strong> Takes one step back, or steps back to the first run of the current word</li>
                        <li><strong>Reset:</strong> Goes back to the beginning of the compression</li>
                    </ul>
                </div>
            </div>
        </section>
        <section id="diff-checker" class="content-section">
            <h2>Using the Diff Checker</h2>
            <p>The Diff Checker helps you verify if your compression implementation is working correctly by comparing your output with the expected results.</p>

            <div class="animation-demo">
                <img src="../assets/diffchecker.png" alt="Diff Checker demonstration" class="feature-image mb-3 rounded">
            </div>

            <div class="parameters-section">
                <h3>How it works:</h3>
                <ul>
                    <li><strong>Preform Compression:</strong> Toggle this depending on if you want the program to only compare an expected compression, or to also compress.</li>
                    <li><strong>Your Compression:</strong> Paste the compressed bitstring from your program's output.</li>
                    <li><strong>Uncompressed Data:</strong> This is where your uncompressed bitmap goes. (Or Expected Compression, if you don't have preform compression selected.)</li>
                    <li><strong>Comparison Process:</strong>
                        <ol>
                            <li>Click "Compare" to see a line-by-line diff below the input boxes</li>
                            <li>Click any different line to highlight specific word differences</li>
                            <li>View detailed word-by-word differences in a scrollable comparison box</li>
                            <li>Click individual words to see a bit-by-bit breakdown of differences</li>
                        </ol>
                    </li>
                </ul>
            </div>

            <div class="highlight-box">
                <h4>Other Features</h4>
                <ul>
                    <li>Transpose: This button will transpose the uncompressed data.</li>
                    <li>Choose File: Select custom input files</li>
                    <li>Download Compressed file: This will preform the selected compression and immediatly download the compressed result.</li>
                </ul>
            </div>

            <!-- <div class="tip">
                <strong>Pro Tip:</strong> Use the Animation page to generate correct outputs for your test cases. The results will automatically carry over to the Diff Checker for easy comparison.
            </div> -->

            <div class="start-button-container">
                <a href="diff_checker.html" class="btn btn-primary btn-lg">
                    Try Diff Checker
                    <svg width="16" height="16" fill="currentColor" class="bi bi-arrow-right" viewBox="0 0 16 16" style="margin-left: 0.5rem;">
                        <path fill-rule="evenodd" d="M1 8a.5.5 0 0 1 .5-.5h11.793l-3.147-3.146a.5.5 0 0 1 .708-.708l4 4a.5.5 0 0 1 0 .708l-4 4a.5.5 0 0 1-.708-.708L13.293 8.5H1.5A.5.5 0 0 1 1 8z"/>
                    </svg>
                </a>
            </div>
        </section>

        

        <section class="content-section">
            <h2>Compression Algorithms</h2>
            
            <div id="wah" class="algorithm-section">
                <div class="algorithm-header">
                    <h3>Word-Aligned Hybrid (WAH)</h3>
                    
                </div>
                
                <div class="algorithm-description">
                    <p>WAH compression works by encoding sequences of bits in two ways:</p>
                    <ul>
                        <li>As runs of identical bits (compressed words).</li>
                        <li>As literal values (uncompressed words).</li>
                    </ul>
                    
                    <div class="highlight-box">
                        <strong>Key Points:</strong>
                        <ul>
                            <li>For word size 8, encodes runs or literals of 7 bits (always one less than word size).</li>
                            <li>Uses 1-2 header bits to indicate word type.</li>
                            <li>For runs: 
                                <ul>
                                    <li>First bit 1 = run, second bit determines if run is 1's (1) or 0's (0).</li>
                                    <li>The bits following the header indicate the number of runs.</li>
                                    <li>If there are more runs than we can indicate, a new compression word is started.</li>
                                </ul>
                            </li>
                            <li>For literals: First bit 0, remaining bits store actual data.</li>
                        </ul>
                    </div>
                </div>

                <div class="example-box">
                    <h4>Example (WAH 8 Compression)</h4>
                    
                    <div class="example-section">
                        <h5>Uncompressed Data:</h5>
                        <div class="example-data">
                            <span>1010101</span>
                            <span>1111111 1111111 1111111</span>
                            <span class="run-indicator">[65 runs of zeros]</span>
                            <span>1010101</span>
                        </div>
                    </div>

                    <div class="example-section">
                        <h5>Compressed Result:</h5>
                        <div class="example-data">
                            <span>01010101</span>
                            <span>11000011</span>
                            <span>10111111</span>
                            <span>10000011</span>
                            <span>01010101</span>
                        </div>
                    </div>

                    <p class="mt-3">This example demonstrates WAH compression with:</p>
                    <ul>
                        <li>Literal values at the start and end</li>
                        <li>A run of ones (3 words)</li>
                        <li>A long run of zeros (65 words)</li>
                    </ul>

                    <button class="btn btn-primary try-example-btn" onclick="tryExample('1010101111111111111111111111' + generateRuns(7, 66) + '1010101', 8, 'wah')">
                        <svg width="16" height="16" fill="currentColor" class="bi bi-play-fill" viewBox="0 0 16 16">
                            <path d="m11.596 8.697-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393z"/>
                        </svg>
                        Try this example
                    </button>
                </div>

            </div>

            <div id="bbc" class="algorithm-section">
                <div class="algorithm-header">
                    <h3>Byte-aligned Bitmap Compression (BBC)</h3>
                </div>
                <div class="algorithm-description">
                    <p>BBC focuses on compressing runs of zero bits. It can store runs of various lengths and also handles “dirty bits” 
                       to indicate small interruptions in zero runs. If more runs or literals need encoding, additional header bytes 
                       are used. BBC is only avalible in wordsize 8, where it compresses runs and literals of 8 bits, in compression words which are also 8 bits.</p>
                    <div class="highlight-box">
                        <strong>Key Points:</strong>
                        <ul>
                            <li>Only runs of zeroes are compressed.</li>
                            <li>Up to 7 runs stored via an initial 3-bit field (e.g., <code>111</code> for run header).</li>
                            <li>A 4th bit determines if the next 4 bits track a dirty bit or the number of literal bytes following the run.</li>
                            <li>Long runs may span multiple compressed words if they exceed capacity (e.g., over 128 runs).
                                <ul>
                                    <li>1 to 6 runs: Encoded directly in the first 3 bits.</li>
                                    <li>7 to 126 runs: First 3 bits "111", the next bytes first bit is "0", followed by 7 bits for run length.</li>
                                    <li>127 to 32767 runs: First 3 bits "111", the next bytes first bit is "1", followed by 15 bits for run length.</li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="example-box">
                    <h4>Example (BBC 8 Compression)</h4>
                    
                    <div class="example-section">
                        <h5>Uncompressed Data:</h5>
                        <div class="example-data">
                            <span>00000000 00000000 01000000</span>
                            <span class="run-indicator">[4 runs of zeros]</span>
                            <span>10101010</span>
                            <span class="run-indicator">[13 runs of zeros]</span>
                            <span>10101010</span>
                            <span class="run-indicator">[130 runs of zeros]</span>
                            <span>10101010 10101010</span>
                        </div>
                    </div>

                    <div class="example-section">
                        <h5>Compressed Result:</h5>
                        <div class="example-data">
                            <span>01010001</span>
                            <span>10000001</span>
                            <span>10101010</span>
                            <span>11100001</span>
                            <span>00001101</span>
                            <span>10101010</span>
                            <span>11100010</span>
                            <span>10000000</span>
                            <span>10000010</span>
                            <span>10101010</span>
                            <span>10101010</span>
                        </div>
                    </div>

                    <p class="mt-3">This example demonstrates BBC compression with:</p>
                    <ul>
                        <li>A 2-byte run with a dirty bit</li>
                        <li>Multiple zero runs of varying lengths (4, 13, and 130 runs)</li>
                        <li>Literal values between runs</li>
                    </ul>

                    <button class="btn btn-primary try-example-btn"
                            onclick="tryExample(
                                '000000000000000001000000' + generateRuns(8, 4) + '10101010' + generateRuns(8, 13) + '10101010' + generateRuns(8, 130) + '1010101010101010',
                                8, 'bbc')">
                        <svg width="16" height="16" fill="currentColor" class="bi bi-play-fill" viewBox="0 0 16 16">
                            <path d="m11.596 8.697-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393z"/>
                        </svg>
                        Try this example
                    </button>
                </div>
            </div>

            <!-- Add the PLWAH algorithm section -->
            <div id="plwah" class="algorithm-section">
                <div class="algorithm-header">
                    <h3>Position List Word-Aligned Hybrid (PLWAH)</h3>
                </div>
                <div class="algorithm-description">
                    <p>PLWAH works very similarly to WAH, but reserves bits to encode dirty bit positions. For runs of identical bits, 
                       the first two bits behave like WAH’s run indicators, while the next 5 bits track the dirty bit location. 
                       The following bits state the number of runs.</p>
                </div>
                <div class="example-box">
                    <h4>Example (PLWAH 16 Compression)</h4>

                    <div class="example-section">
                        <h5>Uncompressed Data:</h5>
                        <div class="example-data">
                            <span>101000000000000</span>
                            <span>000000000000000</span>
                            <span>000000000000000</span>
                            <span>000000000000000</span>
                            <span>100000000000000</span>
                        </div>
                    </div>

                    <div class="example-section">
                        <h5>Compressed Result:</h5>
                        <div class="example-data">
                            <span>0101000000000000</span>
                            <span>1000010000000011</span>
                        </div>
                    </div>

                    <p class="mt-3">This demonstration shows a literal word, followed by runs ending on a dirty bit.</p>

                    <button class="btn btn-primary try-example-btn"
                            onclick="tryExample('101000000000000000000000000000000000000000000000000000000000100000000000000', 16, 'plwah')">
                            <svg width="16" height="16" fill="currentColor" class="bi bi-play-fill" viewBox="0 0 16 16">
                                <path d="m11.596 8.697-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393z"/>
                            </svg>
                        Try this example
                    </button>
                </div>
            </div>

            <!-- Add the VAL algorithm section -->
            <div id="val" class="algorithm-section">
                <div class="algorithm-header">
                    <h3>Variable Aligned Length (VAL)</h3>
                </div>
                <div class="algorithm-description">
                    <p>VAL builds on WAH but breaks each word into multiple segments. For a 16-bit word with 2 segments, 
                       compression is done in 7-bit chunks. The first bit indicates whether each segment is a run or a literal. 
                       If a segment is a run, its first bit shows whether it’s a run of ones or zeros, with the remainder 
                       tracking the count.</p>
                </div>
                <div class="example-box">
                    <h4>Example (VAL 16, 2 Segments)</h4>
                    
                    <div class="example-section">
                        <h5>Uncompressed Data:</h5>
                        <div class="example-data">
                            <span>1010101 1111111</span>
                            <span>1111111 0000000</span>
                            <span>0000000 1010101</span>
                        </div>
                    </div>

                    <div class="example-section">
                        <h5>Compressed Result:</h5>
                        <div class="example-data">
                            <span>0110101011000010</span>
                            <span>1000000101010101</span>
                        </div>
                    </div>

                    <p class="mt-3">This sequence presents a literal segment followed by a run, then another run ending in a literal.</p>

                    <button class="btn btn-primary try-example-btn"
                            onclick="tryExample('101010111111111111111000000000000001010101', 16, 'val', 2)">
                            <svg width="16" height="16" fill="currentColor" class="bi bi-play-fill" viewBox="0 0 16 16">
                                <path d="m11.596 8.697-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393z"/>
                            </svg>
                        Try this example
                    </button>
                </div>
            </div>

        </section>
        <section class="content-section">
            <h2>Ready to Start?</h2>
            <p>Head over to the <a href="animation.html">Animation page</a> to try it yourself! Experiment with different inputs, test various algorithms, and see how bitmap compression works in real-time. The best way to learn is by doing - try entering your own bit patterns and watch how they get compressed.</p>
        </section>

        

        <!-- <section class="content-section">
            <h2>Diff Checker</h2>
            <p>This feature will compare different versions of your data or algorithms side by side.</p>
        </section> -->

    </div>

    <script>
        function generateRuns(wordSize, runs, zeros = true) {
            const bit = zeros ? '0' : '1';
            return bit.repeat(wordSize * runs);
        }
    
        function tryExample(bitstring, wordSize, compressionType, segments = 2) {
        // Load current animSettings or fall back to defaults
        let settings = JSON.parse(localStorage.getItem('animSettings')) || {
            compressionMethod: 'wah',
            wordSize: 8,
            numSegments: 2
        };

        // Update settings with the desired values
        settings.compressionMethod = compressionType;
        settings.wordSize = wordSize;
        settings.numSegments = segments;

        // Save updated settings and bitstring
        localStorage.setItem('animationSettings', JSON.stringify(settings));
        localStorage.setItem('inputBitstring', bitstring);

        // Navigate to the animation page
        window.location.href = 'animation.html';
    }
    </script>
</body>
</html>
